---
- name: Nginx | Add Nginx repository | RHEL
  ansible.builtin.yum_repository:
     name: nginx
     description: nginx yum repo
     baseurl: "{{ nginx_yum_repository_baseurl }}"
     gpgkey: "{{ nginx_yum_repository_gpgkey }}"
     enabled: true

- name: Ensure nginx is installed
  ansible.builtin.package:
     name: "{{ nginx_package_name }}"
     state: present

- name: Copy nginx configuration
  ansible.builtin.template:
     src: nginx.conf.j2
     dest: /etc/nginx/nginx.conf
     owner: root
     group: root
     mode: '0644'
  notify:
     - Reload nginx

- name: Manage vhosts
  ansible.builtin.import_tasks: vhosts.yml

- name: Ensure nginx service is running as configured
  ansible.builtin.service:
     name: nginx
     state: started
     enabled: true
